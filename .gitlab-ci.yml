image: maven:3-jdk-11

stages:
    - build
    - test
    - buildImage
    - pushImage

#Build stage
buildAuthService:
    stage: build
    script:
        - cd authService
        - mvn package -Dmaven.test.skip=true

#Test stage
testAuthService:
    stage: test
    script:
        - cd authService
        - mvn test

#Build docker image
buildImageAuthService:
    stage: buildImage
    image: docker:20.10.7-dind
    script: 
        - cd authService
        - docker build . -t timgroenen/kwetterauthservice

#push docker image to dockerhub
pushImageAuthService:
    stage: pushImage
    image: docker:20.10.7-dind
    script:
        - cd authService
        - docker login --username $dockerUsername --password $dockerPassword
        - docker push timgroenen/kwetterauthservice
